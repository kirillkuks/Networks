\documentclass[a4paper,12pt]{article}

\usepackage[hidelinks]{hyperref}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{shorttoc}
\usepackage{cmap}
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english, russian]{babel}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{float}
\graphicspath{{./img/}}

\definecolor{linkcolor}{HTML}{000000}
\definecolor{urlcolor}{HTML}{0085FF}
\hypersetup{pdfstartview=FitH,  linkcolor=linkcolor,urlcolor=urlcolor, colorlinks=true}

\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}

\renewcommand*\contentsname{Содержание}

\newcommand{\plot}[4]{
    \begin{figure}[H]
        \begin{center}
            \includegraphics[scale=#4]{#1}
            \caption{#2}
            \label{#3}
        \end{center}
    \end{figure}
}

\begin{document}
    \include{title}
    \newpage

    \tableofcontents
    \listoffigures
    \newpage

    \section{Постановка задачи}
    \quad Нужно реализовать алгоритм решения задачи византийских генералов.

    \section{Теория}
    \quad Имеется $ n $ генералов, из которых $ m $ предатели.
    Между каждым из $ n $ генералов установлен надёжный (исключающий подмену сообщения) канал связи.
    Каждый из $ n - m $ верных генералов каждый раз посылает истинное и неизменяемое сообщение,
    а каждый из $ m $ предателей посылает ложное и, возможно, изменяемое сообщение.
    Верным генералам, в результате обмена сообщений, необходимо определить предателей.

    Будем решать задачу в частном случае, когда число предателей не меняется, и $ n > 3m $.
    Для этого случая существует алгоритм Лампорта, который состоит из следующих шагов.

    \begin{itemize}
        \item Каждый генерал посылает всем остальным сообщение, верные генералы - истинное, предатели - ложное.
        \item В результате у каждого генерала формируется массив из $ n $ элементов (полученных сообщений, включая и своё)
        \item Каждый генерал посылает всем остальным полученный на прошлом шаге массив.
        \item В конце каждый генерал имеет набор векторов, свой и полученный от других генералов.
        Для каждого $ i $ элемента каждого вектора находится то, которое чаще других встречается.
        Если оно встречается как минимум $ n - m $ раз, то оно считается истинным и помещается в результирующий вектор,
        иначе в результирующий вектор помещается нуль. 
    \end{itemize}

    В итоге все верные генералы получат один и тот же набор значений.

    \section{Реализация}
    \quad Весь код написан на языке Python (версии 3.7.3).
    Каждый генерал работает в отдельном потоке.
    Предполагается, что отправленное сообщение не может быть потерянно.
    \href{https://github.com/kirillkuks/Networks/tree/master/lab3}{Ссылка на GitHub с исходным кодом}.

    \section{Результаты}
    Рассмотрим работу алгоритма на примере с общим числом генералов $ n = 9 $ среди которых предателей $ m = 2 $.
    Верный генерал посылает сообщение со своим порядковым номером (индексом),
    а предатель посылает сообщение вида traitor\_$ i $, где $ i $ порядковый номер генерала предателя.
    Предателям соответствуют номера $ 7, 8 $.

    После первых двух этапов, каждый генерал получил следующий вектор.
    \plot{generals1}{Сформированные векторы у каждого генерала}{p:generals1}{1.0}

    Затем каждый верный генерал отправляет сформированный на прошлом этапе вектор.
    Предатель, в свою очередь, отправляет ошибочный вектор,
    добавив к каждому элементу своего массива сообщение traitor\_$ i $,
    где $ i $ порядковый номер генерала, которому предатель посылает сообщение.

    В итоге каждый генерал сформировал следующий набор векторов.
    Для краткости посмотрим, рассмотрим по одному примеру для верного генерала и предателя. 
    \plot{generals2}{Сформированный набор векторов для верного генерала (индекс $ 0 $) и предателя ($ 1 $)}{p:generals2}{0.5}

    В итоге каждый генерал сформировал следующий результирующий вектор.
    None соответствует генералу предателю.
    \plot{generals3}{Итоговый набор у каждого генерала}{p:generals3}{1.0}
 
    Как видно, все генералы сформировали одинаковый итоговый вектор, что означает, что они пришли к согласию и нашли предателей.

    Так же посмотрим, какие результирующие векторы получается в случае $ n \leq 3m $.
    Рассмотрим пример $ n = 5 $, $ m = 2 $.

    В итоге каждый генерал сформировал следующий итоговый вектор.
    \plot{generalsF}{Итоговый набор у каждого генерала в случае $ n \leq 3m $}{p:generalsF}{1.0}

    Как видно на рисунке $ \ref{p:generalsF} $ верные генералы не смогли прийти к согласию.

    \section{Обсуждение}
    Из приведённых результатов можно заметить, что в случае $ n \leq 3m $ есть вероятность,
    что генералы не смогут прийти к согласию. В случае же $ n > 3m $ согласие всегда может быть достигнуто.

\end{document}